<!DOCTYPE html>
<html>
    <head>
        <title>Sanderslando Overhoorder</title>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
        <style>
            .statusbar{
                background-color: #333;
                font-family: Arial;
                bottom: 0px;
                position: fixed;
                width:100%;
                left: 0px;
                color: white;
            }
            
            
            .infomenubar{
                background-color: #333;
                font-family: Arial;
                width:100%;
                position: relative;
            }
            
            .menubar{
                background-color: #333;
                font-family: Arial;
                top: 0px;
                position: fixed;
                width:100%;
                left: 0px;
            }
            
            .menubarmenu{
                float: left;
                overflow: hidden;
            }
            
            .menubarmenubutton{
                cursor: default;
                font-size: 16px;    
                border: none;
                outline: none;
                color: white;
                padding: 14px 16px;
                background-color: inherit;
            }
            
            
            
            .menubarmenucontainer{
                cursor: default;
                display: none;
                position: absolute;
                background-color: #f9f9f9;
                min-width: 160px;
                box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
                z-index: 10;
            }
            
            
            .menubarmenu:hover .menubarmenucontainer{
                display: block;
            }
            
            .menubarmenucontent{
                float: none;
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: block;
                text-align: left;
                vertical-align: central;
            }
            
            
            .menubarmenucontent:hover{
                background-color: aquamarine;
            }
            
            
        </style>
    </head>
    <body>
        
        <div class="menubar">
            <div class="menubarmenu" id="filedropdown">
                <button class="menubarmenubutton"><label id="L0">File</label></button>
                <div class="menubarmenucontainer">
                    <div onclick="newFile()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Gnome-bookmark-new.svg/20px-Gnome-bookmark-new.svg.png" width="20" height="20"> <label id="L1">Create a new testformat</label></div>
                    <div onclick="newOpenFile()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Gnome-document-page-setup.svg/20px-Gnome-document-page-setup.svg.png"> <label id="L2">Edit a testformat</label></div>
                    <div id="ineditmenu" style="display: none">
                        <div onclick="saveFile()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Gnome-document-save.svg/20px-Gnome-document-save.svg.png" width="20" height="20"> <label id="L3">Save testformat</label></div>
                    <div onclick="restoreAllWindows();openfromeditor()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Gnome-document-open.svg/20px-Gnome-document-open.svg.png"> <label id="L4">Take test from editor</label></div>
                    </div>
                    
                    <br/>
                    <div onclick="restoreAllWindows();openfilesystem()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Gnome-document-open.svg/20px-Gnome-document-open.svg.png"> <label id="L5">Take test from disk</label></div>
                    <div onclick="restoreAllWindows();openurl()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/01/Gnome-document-open.svg/20px-Gnome-document-open.svg.png"> <label id="L6">Take test from URL</label></div>
                </div>
            </div>
            <div class="menubarmenu" id="editdropdown">
                <button class="menubarmenubutton"><label id="L7">Edit</label></button>
                <div class="menubarmenucontainer">
                    <a class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/10/Gnome-insert-text.svg/20px-Gnome-insert-text.svg.png"> <label id="L8">Latin</label></a>
                    <br/>
                    <div id="intestmenu" style="display: none">
                    <div onclick="checkandnext()" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Gnome-document-send.svg/20px-Gnome-document-send.svg.png"> <label id="L9">Next question</label></div>
                    <div onclick="" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/Gnome-document-send.svg/20px-Gnome-document-send.svg.png"> <label id="L10">Stop test</label></div>
                    <br/>
                    </div>
                    <a class="menubarmenucontent" onclick="toFullscreen()"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Gnome-view-fullscreen.svg/20px-Gnome-view-fullscreen.svg.png"> <label id="L11">Fullscreen</label></a>
                </div>
            </div>
            <div class="menubarmenu" id="languagedropdown">
                <button class="menubarmenubutton">Language</button>
                <div class="menubarmenucontainer">
                    <div onclick="loadlanguage('en')" class="menubarmenucontent">
                        <img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Flag_of_the_United_Kingdom.svg/20px-Flag_of_the_United_Kingdom.svg.png">
                         English
                    </div>
                    <div onclick="loadlanguage('nl')" class="menubarmenucontent">
                        <img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Flag_of_the_Netherlands.svg/20px-Flag_of_the_Netherlands.svg.png">
                         Nederlands
                    </div>
                    <div onclick="loadlanguage('fi')" class="menubarmenucontent">
                        <img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Flag_of_Finland.svg/20px-Flag_of_Finland.svg.png">
                         Suomi
                    </div>
                </div>
            </div>
            <div class="menubarmenu" id="helpdropdown">
                <button class="menubarmenubutton"><label id="L12">Help</label></button>
                <div class="menubarmenucontainer">
                    <a class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Gnome-help-contents.svg/20px-Gnome-help-contents.svg.png"> <label id="L13">Help</label></a>
                    <a class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/86/Utilities-system-monitor.svg/20px-Utilities-system-monitor.svg.png"> <label id="L14">Report an Issue</label></a>
                    <div onclick="switchTo(mainscreen1);" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Tango-style_info_icon.svg/20px-Tango-style_info_icon.svg.png"> <label id="L15">About</label></div>
                </div>
            </div>
        </div>
        <p>.</p>
        <p>.</p>
        <div style="display: none" id="mainscreen0">
            <div id="fxtrigger" style="width: 100px"></div>
            <div class="infomenubar">
                <div class="menubarmenu" style="background-color: #333">
                    <button class="menubarmenubutton"><label id="L16">Add</label></button>
                    <div class="menubarmenucontainer">
                        <div onclick="addQuestion('org.sanderslando.overhoorder.type.questions.singleanswer.SingleAnswerController','','')" class="menubarmenucontent"><img alt="x" src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/Gnome-bookmark-new.svg/20px-Gnome-bookmark-new.svg.png" width="20" height="20"> <label id="L17">Single answer</label></div>
                    </div>
                </div>
            </div>
        </div>
        <div style="display: none" id="mainscreen1">
            <h1>Copyright Alexandros de Regt 2011-<label id="agalabel"></label></h1>
            <p>Program created by Alexandros de Regt</p>
            <br/>
            <p>Thanks allot to:</p>
            <br/>
            <p><b>Translating</b></p>
            <table>
                <tr>
                    <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/ae/Flag_of_the_United_Kingdom.svg/30px-Flag_of_the_United_Kingdom.svg.png"></td>
                    <td>English</td>
                    <td>A de Regt</td>
                </tr>
                <tr>
                    <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Flag_of_the_Netherlands.svg/30px-Flag_of_the_Netherlands.svg.png"></td>
                    <td>Nederlands - Dutch</td>
                    <td>A de Regt</td>
                </tr>
                <tr>
                    <td><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/bc/Flag_of_Finland.svg/30px-Flag_of_Finland.svg.png"></td>
                    <td>Suomi - Finish</td>
                    <td>Fohu</td>
                </tr>
            </table>
            <br/>
            <p><b>Debugging</b></p>
            <p>Juancarlos Garcia</p>
            <br/>
            <p><b>Images</b></p>
            <p>GNOME desktop icons - Wikipedia</p>
            <p>Lijst van landen in de wereld - Wikipedia</p>
        </div>
        <div style="display: none" id="mainscreen2">
            <fieldset>
                <legend>Duration</legend>
                
            </fieldset>
            <h1>Press start</h1>
            <button>OK</button>
        </div>
        <div style="display: none" id="mainscreen3">
            <h1 id="vraagstelling"></h1>
            <iframe id="questionframe" style="border:none"></iframe>
        </div>
        <div class="statusbar">Copyright Alexandros de Regt | <label id="L18">Actual score:</label> <label id="scorebord"></label></div>
        <script>
            var rawdoc;
            var spldoc;
            var maxquestioncount;
            var randomint;
            var tracebit;
            var varbit;
            var goed = 0;
            var fout = 0;
            var totaal = 0;
            var languages;
            var quam = 0;
            
            agalabel.innerHTML = new Date().getFullYear()+"";
            
            try{
                loadlanguage(navigator.language);
            }catch(e){
                document.write("<p>Laad talen mislukt</p>");
            }
            
            if(window.confirm("Do you allow Google Analytics to track where you go to in our page? We use it to see how well out software works")){
                addAnalytics();
            }
            
            function addAnalytics(){
                var elem = document.createElement("script");
                elem.innerHTML = "(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-103808116-1', 'auto');ga('send', 'pageview');";
                document.body.appendChild(elem);
            }
            
            function loadlanguage(sellang){
                $.get((document.URL).replace("/main.html","").replace("\\main.html","")+"/lang/"+(sellang.substring(0,2))+".taal", function(response) {
                        var tgv = response.replace("\r","").replace("\t","").trim();
                        languages = tgv.split("\n");
                        L0.innerHTML = getLanguage("bestand");
                        L1.innerHTML = getLanguage("createformat");
                        L2.innerHTML = getLanguage("editformat");
                        L3.innerHTML = getLanguage("saveformat");
                        L4.innerHTML = getLanguage("usetest");
                        L5.innerHTML = getLanguage("takefromdisk");
                        L6.innerHTML = getLanguage("takefromurl");
                        L7.innerHTML = getLanguage("edit");
                        L8.innerHTML = getLanguage("latin");
                        L9.innerHTML = getLanguage("nextquestion");
                        L10.innerHTML = getLanguage("stoptest");
                        L11.innerHTML = getLanguage("volledigscherm");
                        L12.innerHTML = getLanguage("help");
                        L13.innerHTML = getLanguage("help");
                        L14.innerHTML = getLanguage("report");
                        L15.innerHTML = getLanguage("about");
                        L16.innerHTML = getLanguage("toevoegen");
                        L17.innerHTML = getLanguage("enkelvoudigevraag");
                        L18.innerHTML = getLanguage("score");
                });
            }
            
            function openfromeditor(){
                var content = "";
                for(var i = 0 ; i < quam ; i++){
                    content += document.getElementById("XXX"+i).contentWindow.saveX()+"\n";
                }
                rawdoc = content;
                decodeRawDoc();
            }
            
            function newOpenFile(){
                newFile();
                var file = document.createElement("input");
                file.type = "file";
                file.addEventListener('change',function(e){
                    var f = e.target.files[0];
                    var reader = new FileReader();
                    reader.onload = function(e){
                        rawdoc = e.target.result;
                        extractDocInfo();
                        for(var i = 0 ; i < maxquestioncount ; i++){
                            addQuestion(getValue(i+".answer.class"),getValue(i+".question"),getValue(i+".answer.string"));
                        }
                    };
                    reader.readAsText(f);
                },false);
                file.click();
            }
            
            function saveFile(){
                var content = "";
                for(var i = 0 ; i < quam ; i++){
                    content += document.getElementById("XXX"+i).contentWindow.saveX()+"\n";
                }
                var blooper = new Blob([content], {type: "octet/stream"});
                var url = window.URL.createObjectURL(blooper);
                var a = document.createElement("a");
                a.href = url;
                a.download = window.prompt("Which name?")+".stf";
                a.click();
            }
            
            function newFile(){
                fxtrigger.innerHTML = '';
                switchTo(mainscreen0);
                quam = 0;
                ineditmenu.style.display = "block";
            }
            
            function addQuestion(type,A,B){
                var target = (document.URL).replace("/main.html","").replace("\\main.html","")+"/edit/"+type+".html";
                var dict = document.createElement("iframe");
                fxtrigger.appendChild(dict);
                dict.src = target;
                dict.style.border = "solid black 1px";
                dict.className = "dict";
                var nerd = quam++;
                dict.onload = function(e){
                    dict.contentWindow.load(nerd,A,B);
                };
                dict.id = "XXX"+nerd;
            }
            
            
            function next(){
                var lastrnd = randomint;
                while((randomint=(Math.floor(Math.random()*maxquestioncount)))===lastrnd){}
                var vx = getValue(randomint+".question");
                if(vx===null||vx==="null"){
                    next();
                }
                vraagstelling.innerHTML = vx;
                if(vraagstelling.innerHTML==="null"){
                    next();
                }
                tracebit = getValue(randomint+".answer.class");
                varbit = getValue(randomint+".answer.string");
                questionframe.src = (document.URL).replace("/main.html","").replace("\\main.html","")+"/view/"+tracebit+".html";
                questionframe.onload = function(e){
                    try{
                        document.getElementById("questionframe").contentWindow.setup(varbit);
                        document.getElementById("questionframe").contentWindow.trigger(checkandnext);
                        document.getElementById("questionframe").contentWindow.focus();
                    }catch(x){
                        next();
                    }
                };
            }
            
            function getValue(msg){
                for(var i = 0 ; i < spldoc.length ; i++){
                    var deze = spldoc[i].split("=");
                    if(deze[0]===msg){
                        return deze[1].replace("\n","").trim();
                    }
                }
                return null;
            }
            
            
            function getLanguage(msg){
                for(var i = 0 ; i < languages.length ; i++){
                    var deze = languages[i].split("=");
                    if(deze[0]===msg){
                        return deze[1].replace("\n","").trim();
                    }
                }
                return null;
            }
            
            function extractDocInfo(){
                rawdoc = rawdoc.replace("\r","").replace("\t","").trim();
                spldoc = rawdoc.split("\n");
                maxquestioncount = 0;
                while(true){
                    if(getValue(maxquestioncount+".question")===null){
                        break;
                    }
                    maxquestioncount++;
                }
                goed = 0;
                fout = 0;
                totaal = 0;
            }
            
            function decodeRawDoc(){
                extractDocInfo();
                switchTo(mainscreen3);
                intestmenu.style.display = "block";
                next();
            }
            
            function checkandnext(){
                if(document.getElementById("questionframe").contentWindow.check()){
                    goed++;
                }else{
                    fout++;
                }
                totaal++;
                var score = (goed/totaal)*10;
                if(score>54){
                    scorebord.style.color = "green";
                }else{
                    scorebord.style.color = "red";
                }
                scorebord.innerHTML = score;
                next();
            }
            
            /**
             *  Opens file from url and store it to general string
             * @returns {undefined}
             */
            function openurl(){
                $.get(window.prompt("Giveup url"), function(response) {
                     rawdoc = response;
                     decodeRawDoc();
                });
            }

            
            /**
             *  Opens file on hdd and store it to general string
             * @returns {undefined}
             */
            function openfilesystem(){
                var file = document.createElement("input");
                file.type = "file";
                file.addEventListener('change',function(e){
                    var f = e.target.files[0];
                    var reader = new FileReader();
                    reader.onload = function(e){
                        rawdoc = e.target.result;
                        decodeRawDoc();
                    };
                    reader.readAsText(f);
                },false);
                file.click();
                
            }
            
            function switchTo(to){
                restoreAllWindows();
                to.style.display = "inline";
            }
            
            function restoreAllWindows(){
                intestmenu.style.display = "none";
                ineditmenu.style.display = "none";
                for(var i = 0 ; i < 100 ; i++){
                    var tt = document.getElementById("mainscreen"+i);
                    if(tt!==null){
                        tt.style.display = "none";
                    }
                }
            }
            
            /**
             * Parameter extractor function.
             * from: https://stackoverflow.com/questions/11582512/how-to-get-url-parameters-with-javascript
             * @param {type} name of parameter
             * @returns {unresolved} value of parameter
             */
            function getURLParameter(name) {
                return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\+/g, '%20')) || null;
            }
            
            /**
             * Go fullscreen
             * From: https://stackoverflow.com/questions/3900701/onclick-go-full-screen
             * @returns {undefined}
             */
            function toFullscreen(){
                if ((document.fullScreenElement && document.fullScreenElement !== null) || (!document.mozFullScreen && !document.webkitIsFullScreen)) {
                 if (document.documentElement.requestFullScreen) {  
                   document.documentElement.requestFullScreen();  
                 } else if (document.documentElement.mozRequestFullScreen) {  
                   document.documentElement.mozRequestFullScreen();  
                 } else if (document.documentElement.webkitRequestFullScreen) {  
                   document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);  
                 }  
               } else {  
                 if (document.cancelFullScreen) {  
                   document.cancelFullScreen();  
                 } else if (document.mozCancelFullScreen) {  
                   document.mozCancelFullScreen();  
                 } else if (document.webkitCancelFullScreen) {  
                   document.webkitCancelFullScreen();  
                 }  
               } 
            }
        </script>
    </body>
</html>